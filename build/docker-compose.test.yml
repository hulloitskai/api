## This docker-compose config file is used to define test variations of the
## images in this repository.

version: "3.7"

services:
  api_test:
    image: "stevenxie/api-tester:latest"
    build:
      context: ..
      dockerfile: ./build/tester.Dockerfile
      cache_from:
        - stevenxie/api-tester:latest
        - golang:1
    container_name: api_test
    working_dir: "/app"
    volumes:
      - type: bind
        source: .
        target: /app

  varnish_test:
    image: "cooptilleuls/varnish:6.0.0-alpine"
    command: ["varnishd", "-Cf", "/usr/local/etc/varnish/default.vcl"]
    volumes:
      - type: bind
        source: ./varnish.vcl
        target: /usr/local/etc/varnish/default.vcl
        read_only: true
